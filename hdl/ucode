#   This file is part of JTKCPU.
#   JTKCPU program is free software: you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or
#   (at your option) any later version.

#   JTKCPU program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.

#   You should have received a copy of the GNU General Public License
#   along with JTKCPU.  If not, see <http://www.gnu.org/licenses/>.

#   Author: Jose Tejada Gomez. Twitter: @topapate
#   Version: 1.0
#   Date: 3-03-2023 

# Solves an ALU operation in a single clock
# Will wait for OPN1 to be ready

NOPE: NI

SINGLE_ALU:       OPN0=REGS, OPN1=MEM, UPREGS=ALU, NI

SINGLE_ALU_16:    READ16
                  OPN0=REGS, OPN1=MEM, UPREGS=ALU, NI

SINGLE_ALU_IDX:   ADRIDX
                  OPN0=REGS, OPN1=MEM, UPREGS=ALU, NI

SINGLE_ALU_IDX16: ADRIDX, READ16
                  OPN0=REGS, OPN1=MEM, UPREGS=ALU, NI

MULTI_ALU: OPN0=REGS, OPN1=MEM, WAITALU
           UPREGS=ALU, NI

SBRANCH: PC=BRANCH, EXTSGN, NI 

LBRANCH: WAIT16
         PC=BRANCH, NI

LOOPX: PC_XNZ=BRANCH, DECX, NI
LOOPB: PC_BNZ=BRANCH, DECB, NI

MOVE:  ADRX, DECU 
       OPN0=MEM, WE, ADRY
       NI

BMOVE: ADRY, DECU 
       OPN0=MEM, WE, ADRX, PC_UNZ=BRANCH
       NI

BSETA: ADRA, DECU 
       OPN0=MEM, WE, ADRX, PC_UNZ=BRANCH
       NI

BSETD: DECU 
       OPN0=REGS, WE, ADRX, PC_UNZ=BRANCH
       NI 

JUMP: PC=BRANCH, READ16, NI

JMSR: PC=BRANCH, READ16, NI

RTIT: IFIRQ PULALL, IFFIRQ PULPC, PULCC
     NI

RTSR: PC=PULS, NI

PSH:

PUL:

FIRQ: E=0, PSHPC, PSHCC, F=1, I=1, PC=VECTOR
      NI

IRQ:  E=1, PSHALL, I=1, PC=VECTOR 
      NI

NMI:  E=1, PSHALL, I=1, F=1, PC=VECTOR 
      NI

SETLINES: ???

STORE8:  OPN0=REGS, ADRIDX, WE, NI

STORE16: ADRIDX, READ16 
         OPN0=REGS, WE, NI